# ams.project 3.0.1 - Full Stack Manifest
# Enterprise Project Planning and Resource Management System

metadata:
  name: ams.project
  displayName: ams.project
  description: Enterprise Project Planning, Resource Management and ERP Integration Platform
  productVersion: "3.0.1"
  category: Enterprise
  tags:
    - ams
    - project-management
    - erp
    - planning
    - identity

variables:
  # ===========================================
  # Registry & Versioning
  # ===========================================
  REGISTRY:
    label: Docker Registry
    description: Docker registry for ams.project images
    type: String
    default: amssolution
    group: Registry
    order: 1

  TAG:
    label: Image Tag
    description: Docker image tag version
    type: String
    default: latest
    group: Registry
    order: 2

  PLATFORM:
    label: Platform
    description: Target platform (linux/windows)
    type: Select
    default: linux
    options:
      - value: linux
        label: Linux
      - value: windows
        label: Windows
    group: Registry
    order: 3

  ERP_MAIN_VERSION:
    label: ERP Main Version
    description: ERP system main version for wage-data-api
    type: Select
    default: "11"
    options:
      - value: "10"
        label: ERP 10
      - value: "11"
        label: ERP 11
      - value: "12"
        label: ERP 12
    group: Registry
    order: 4

  # ===========================================
  # Network Configuration
  # ===========================================
  AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP:
    label: External DNS/IP
    description: External DNS name or IP address for service access
    type: String
    default: host.docker.internal
    group: Network
    order: 1

  # ===========================================
  # Database Configuration
  # ===========================================
  AMS_DB:
    label: AMS Database Connection
    description: SQL Server connection string for AMS database
    type: SqlServerConnectionString
    default: "Server=ams-mssql;Database=AMS01;User Id=sa;Password=YourStrongPassword123!;TrustServerCertificate=true;"
    required: true
    group: Database
    order: 1

  IDENTITY_ACCESS_DB:
    label: Identity Database Connection
    description: SQL Server connection string for Identity database
    type: SqlServerConnectionString
    default: "Server=ams-mssql;Database=AMS01-Identity;User Id=sa;Password=YourStrongPassword123!;TrustServerCertificate=true;"
    required: true
    group: Database
    order: 2

  # ===========================================
  # Infrastructure - EventStore & Redis
  # ===========================================
  EVENTSTORE_DB:
    label: EventStore Connection (TCP)
    description: EventStore TCP connection string
    type: String
    default: "tcp://admin:changeit@eventstore:1113"
    group: Infrastructure
    order: 1

  GRPC_EVENTSTORE_DB:
    label: EventStore Connection (gRPC)
    description: EventStore gRPC connection string for newer services
    type: String
    default: "esdb://admin:changeit@eventstore.db:2113?tls=false"
    group: Infrastructure
    order: 2

  REDIS_DB:
    label: Redis Connection
    description: Redis cache hostname
    type: String
    default: cachedata
    group: Infrastructure
    order: 3

  # ===========================================
  # Service Bus Configuration
  # ===========================================
  SERVICE_BUS_CATALOG:
    label: Service Bus Catalog
    description: NServiceBus catalog name
    type: String
    default: AMS01
    group: ServiceBus
    order: 1

  SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER:
    label: Circuit Breaker Timeout
    description: Time to wait before triggering circuit breaker (seconds)
    type: Number
    default: "120"
    min: 30
    max: 600
    group: ServiceBus
    order: 2

  EXIT_ON_CRITICAL_ERROR:
    label: Exit on Critical Error
    description: Whether to exit services on critical NServiceBus errors
    type: Boolean
    default: "false"
    group: ServiceBus
    order: 3

  # ===========================================
  # Logging Configuration
  # ===========================================
  MIN_LOG_LEVEL:
    label: Minimum Log Level
    description: Minimum log level for Serilog
    type: Select
    default: Fatal
    options:
      - value: Verbose
        label: Verbose
      - value: Debug
        label: Debug
      - value: Information
        label: Information
      - value: Warning
        label: Warning
      - value: Error
        label: Error
      - value: Fatal
        label: Fatal
    group: Logging
    order: 1

  LOG_MAX_SIZE:
    label: Log Max Size
    description: Maximum size per log file
    type: String
    default: 5m
    group: Logging
    order: 2

  LOG_MAX_FILE:
    label: Log Max Files
    description: Maximum number of log files to keep
    type: Number
    default: "3"
    min: 1
    max: 100
    group: Logging
    order: 3

  # ===========================================
  # Localization
  # ===========================================
  CULTURE_CODE:
    label: Culture Code
    description: Culture code for localization
    type: Select
    default: de-DE
    options:
      - value: de-DE
        label: German (Germany)
      - value: en-US
        label: English (US)
      - value: en-GB
        label: English (UK)
    group: Localization
    order: 1

  # ===========================================
  # Identity & Security
  # ===========================================
  IDENTITY_ACCESS_CERT_PATH:
    label: Certificate Path
    description: Path to the identity API certificate
    type: String
    default: /etc/ssl/certs/identity-api.pfx
    group: Security
    order: 1

  IDENTITY_ACCESS_CERT_PASSWORD:
    label: Certificate Password
    description: Password for the identity certificate
    type: Password
    default: "P@ssw0rd!"
    group: Security
    order: 2

  # ===========================================
  # Email Configuration
  # ===========================================
  MAIL_SERVER:
    label: Mail Server
    description: SMTP server hostname
    type: String
    default: host.docker.internal
    group: Email
    order: 1

  MAIL_PORT:
    label: Mail Port
    description: SMTP server port
    type: Port
    default: "25"
    group: Email
    order: 2

  MAIL_SENDER_NAME:
    label: Sender Name
    description: Display name for sent emails
    type: String
    default: ams.project
    group: Email
    order: 3

  MAIL_SENDER:
    label: Sender Address
    description: Email address for sent emails
    type: String
    default: noreply@host.docker.internal
    pattern: "^[^@]+@[^@]+$"
    patternError: Must be a valid email address
    group: Email
    order: 4

  MAIL_PASSWORD:
    label: Mail Password
    description: SMTP authentication password (if required)
    type: Password
    default: ""
    group: Email
    order: 5

  MAIL_IS_AUTHENTICATION_REQUIRED:
    label: Authentication Required
    description: Whether SMTP authentication is required
    type: Boolean
    default: "false"
    group: Email
    order: 6

services:
  # ===========================================
  # LOGGING INFRASTRUCTURE
  # ===========================================
  elasticsearch:
    build:
      context: elk/elasticsearch/
    restart: always
    volumes:
      - ./elk/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro
    environment:
      ES_JAVA_OPTS: "-Xmx256m -Xms256m"

  logstash:
    build:
      context: elk/logstash/
    restart: always
    ports:
      - "8080:8080"
    volumes:
      - ./elk/logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml:ro
      - ./elk/logstash/pipeline:/usr/share/logstash/pipeline:ro
    environment:
      LS_JAVA_OPTS: "-Xmx256m -Xms256m"
    depends_on:
      - elasticsearch

  kibana:
    build:
      context: elk/kibana/
    restart: always
    ports:
      - "5601:5601"
    volumes:
      - ./elk/kibana/config/:/usr/share/kibana/config:ro
    depends_on:
      - elasticsearch

  # ===========================================
  # CORE INFRASTRUCTURE
  # ===========================================
  eventstore:
    image: eventstore/eventstore:release-5.0.11
    restart: always
    init: true
    ports:
      - "2113:2113"
      - "1113:1113"
    volumes:
      - esdata:/var/lib/eventstore
      - esindex:/var/lib/eventstore-index

  eventstore.db:
    image: docker.eventstore.com/eventstore/eventstoredb-ee:latest
    restart: always
    init: true
    ports:
      - "2114:2113"
      - "1114:1113"
    environment:
      EVENTSTORE_CLUSTER_SIZE: "1"
      EVENTSTORE_RUN_PROJECTIONS: All
      EVENTSTORE_START_STANDARD_PROJECTIONS: "true"
      EVENTSTORE_NODE_PORT: "2113"
      EVENTSTORE_INSECURE: "true"
      EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP: "true"
    volumes:
      - eventstore-volume-data:/var/lib/eventstore
      - eventstore-volume-logs:/var/log/eventstore

  cachedata:
    image: redis:alpine
    restart: always
    command: redis-server --include /usr/local/etc/redis/redis.conf
    volumes:
      - ./redis/redis.conf:/usr/local/etc/redis/redis.conf
      - ./redis/data:/data

  # ===========================================
  # MONITORING
  # ===========================================
  healthmonitor:
    image: ${REGISTRY}/itops.healthmonitor:linux-v3-pre
    restart: always
    ports:
      - "5100:80"
    volumes:
      - healthdata:/app/data
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  watchdog:
    image: ${REGISTRY}/watchdog:linux-latest
    restart: always
    ports:
      - "5101:80"
      - "161:161/udp"
    environment:
      ConnectionStrings__Monitoring: ${AMS_DB}
      SNMP_COMMUNITY: public
      SNMP_PORT: "161"
      ASPNETCORE_URLS: http://0.0.0.0:80
      HealthCheckAddresses__0: http://projectmanagement/hc
      HealthCheckAddresses__1: http://projectmanagement-api/hc
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # AUTHORIZATION (PolicyServer)
  # ===========================================
  policyserver:
    image: ${REGISTRY}/policyserver:linux-v2.4.0
    restart: always
    environment:
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__IdentityAccess: ${IDENTITY_ACCESS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  policyserver-manager-api:
    image: ${REGISTRY}/policyserver.manager.api:linux-v2.4.0
    restart: always
    ports:
      - "7612:80"
    environment:
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__IdentityAccess: ${IDENTITY_ACCESS_DB}
      CultureCode: ${CULTURE_CODE}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  policyserver-manager-userselector-api:
    image: ${REGISTRY}/policyserver.manager.userselector.api:linux-v2.4.0
    restart: always
    ports:
      - "7613:80"
    environment:
      ConnectionStrings__IdentityAccess: ${IDENTITY_ACCESS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # IDENTITY ACCESS
  # ===========================================
  identity-api:
    image: ${REGISTRY}/identityaccess.identityserver:linux-v2.4.0
    restart: always
    ports:
      - "7614:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__IdentityAccess: ${IDENTITY_ACCESS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      CultureCode: ${CULTURE_CODE}
      IdentityServerUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:7614
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
      CertificatePath: ${IDENTITY_ACCESS_CERT_PATH}
      CertificatePassword: ${IDENTITY_ACCESS_CERT_PASSWORD}
      SERVICE_BUS_CATALOG: ${SERVICE_BUS_CATALOG}
    volumes:
      - profilePictures:/app/wwwroot/picture
      - ./certs:/etc/ssl/certs:ro

  adminportal:
    image: ${REGISTRY}/identityaccess.adminportal:linux-v2.4.0
    restart: always
    ports:
      - "7615:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__IdentityAccess: ${IDENTITY_ACCESS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      CultureCode: ${CULTURE_CODE}
      IdentityServerUrl: http://identity-api
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
      SERVICE_BUS_CATALOG: ${SERVICE_BUS_CATALOG}

  identityaccess-clienthub:
    image: ${REGISTRY}/identityaccess.clienthub:linux-v2.4.0
    restart: always
    ports:
      - "7616:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__IdentityAccess: ${IDENTITY_ACCESS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
      SERVICE_BUS_CATALOG: ${SERVICE_BUS_CATALOG}

  identityaccess-emailsender:
    image: ${REGISTRY}/identityaccess.emailsender:linux-v2.4.0
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__IdentityAccess: ${IDENTITY_ACCESS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      CultureCode: ${CULTURE_CODE}
      EmailSettings__MailServer: ${MAIL_SERVER}
      EmailSettings__Port: ${MAIL_PORT}
      EmailSettings__SenderName: ${MAIL_SENDER_NAME}
      EmailSettings__Sender: ${MAIL_SENDER}
      EmailSettings__Password: ${MAIL_PASSWORD}
      EmailSettings__IsAuthenticationRequired: ${MAIL_IS_AUTHENTICATION_REQUIRED}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
      SERVICE_BUS_CATALOG: ${SERVICE_BUS_CATALOG}
    volumes:
      - ./certs:/etc/ssl/certs

  # ===========================================
  # BFF (Backend for Frontend)
  # ===========================================
  desktopschedulingapigw:
    image: ${REGISTRY}/desktopschedulingapigw:${PLATFORM}-${TAG}
    restart: always
    ports:
      - "5200:80"
      - "15200:9901"
      - "10000:10000"

  desktopprojectplanningcomposition:
    image: ${REGISTRY}/desktop.projectplanning.compositiongateway:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      Urls__ProjectManagement: http://projectmanagement-api
      Urls__SalesOrders: http://salesorders-api
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  clienthub:
    image: ${REGISTRY}/itops.clienthub:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # COLLABORATION
  # ===========================================
  collaboration-api:
    image: ${REGISTRY}/collaboration.api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # PLANNING - CAPACITY UTILIZATION
  # ===========================================
  planning-capacityutilization-api:
    image: ${REGISTRY}/planning.capacityutilization.api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # PLANNING - PROJECTS
  # ===========================================
  projectmanagement-api:
    image: ${REGISTRY}/projectmanagement.api:${PLATFORM}-${TAG}
    restart: always
    ports:
      - "3080:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      IdentityServerUrl: http://identity-api
      ConnectionStrings__ProjectManagement: ${AMS_DB}
      ConnectionStrings__Cache: ${REDIS_DB}
      ConnectionStrings__EventStore: ${EVENTSTORE_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
      RunMigrations: "True"
    depends_on:
      - cachedata

  projectmanagement:
    image: ${REGISTRY}/projectmanagement:${PLATFORM}-${TAG}
    restart: always
    ports:
      - "3081:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      ConnectionStrings__ams: ${AMS_DB}
      CultureCode: ${CULTURE_CODE}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  projectmanagement-readmodelgenerator:
    image: ${REGISTRY}/projectmanagement.readmodelgenerator:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__EventStore: ${EVENTSTORE_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  projectmanagement-erpdata:
    image: ${REGISTRY}/projectmanagement.erpdata:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__EventStore: ${EVENTSTORE_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # PLANNING - REPORTING
  # ===========================================
  planning-reporting-api:
    image: ${REGISTRY}/scheduling.reporting.api:${PLATFORM}-${TAG}
    restart: always
    ports:
      - "7608:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080

  planning-reporting-clienthub:
    image: ${REGISTRY}/scheduling.reporting.clienthub:${PLATFORM}-${TAG}
    restart: always
    ports:
      - "7900:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080

  # ===========================================
  # PLANNING - TRACKING (ACCOUNTING)
  # ===========================================
  accounting-api:
    image: ${REGISTRY}/accounting.api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__Cache: ${REDIS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  accounting-capacitydispatcher:
    image: ${REGISTRY}/accounting.resourcecapacitydispatcher:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__Cache: ${REDIS_DB}
      ConnectionStrings__ams: ${AMS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  accounting-integration:
    image: ${REGISTRY}/accounting.integration:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  capacityplanning-api:
    image: ${REGISTRY}/capacityplanning.api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_HTTP_PORTS: "80"
      ConnectionStrings__ams: ${AMS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  capacityplanning-readmodelgenerator:
    image: ${REGISTRY}/capacityplanning.readmodelgenerator:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_HTTP_PORTS: "80"
      ConnectionStrings__ams: ${AMS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
      Throttling__Rate: "00:00:01"
      Throttling__Limit: "2"
      Throttling__AdditionalResetTime: "00:00:00"

  # ===========================================
  # PLANNING - TYPE CURVE
  # ===========================================
  planning-typecurve-api:
    image: ${REGISTRY}/planning-typecurve-api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # PRODUCTION PLANNING (BOM)
  # ===========================================
  bom-api:
    image: ${REGISTRY}/productionplanning.bom.api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}

  bom-readmodelgenerator:
    image: ${REGISTRY}/productionplanning.readmodelgenerator:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ConnectionStrings__ams: ${AMS_DB}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  erpreadmodel-readmodelgenerator:
    image: ${REGISTRY}/erpreadmodel.readmodelgenerator:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # PROJECT EXPORTING
  # ===========================================
  projectexporting-readmodelgenerator:
    image: ${REGISTRY}/projectexporting.readmodelgenerator:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ConnectionStrings__ams: ${AMS_DB}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  projectexporting-api:
    image: ${REGISTRY}/projectexporting.api:${PLATFORM}-${TAG}
    restart: always
    ports:
      - "7700:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  projectexporting-client:
    image: ${REGISTRY}/projectexporting.client:${PLATFORM}-${TAG}
    restart: always

  # ===========================================
  # SALES ORDERS
  # ===========================================
  salesorders-api:
    image: ${REGISTRY}/salesorders.api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__Cache: ${REDIS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
    depends_on:
      - cachedata

  salesorders-integration:
    image: ${REGISTRY}/salesorders.integration:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__Cache: ${REDIS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      CultureCode: ${CULTURE_CODE}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}
    depends_on:
      - cachedata

  salesorders:
    image: ${REGISTRY}/salesorders:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  projectplanning.salesorders-client:
    image: ${REGISTRY}/projectplanning.salesorders.client:${PLATFORM}-${TAG}
    restart: always

  # ===========================================
  # WAGE DATA
  # ===========================================
  wage-data-api:
    image: ${REGISTRY}/wage.data.api:${PLATFORM}-${TAG}-erp${ERP_MAIN_VERSION}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ServiceBusTimeToWaitBeforeTriggeringCircuitBreaker: ${SERVICE_BUS_TIME_TO_WAIT_BEFORE_TRIGGERING_CIRCUIT_BREAKER}
      ExitOnCriticalError: ${EXIT_ON_CRITICAL_ERROR}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  # ===========================================
  # DISCUSSIONS
  # ===========================================
  discussions-api:
    image: ${REGISTRY}/discussions.api:${PLATFORM}-${TAG}
    restart: always
    ports:
      - "7710:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      ConnectionStrings__EventStore: ${GRPC_EVENTSTORE_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  discussion-client:
    image: ${REGISTRY}/discussion.client:${PLATFORM}-${TAG}
    restart: always

  # ===========================================
  # MEMO
  # ===========================================
  memo-api:
    image: ${REGISTRY}/memo.api:${PLATFORM}-${TAG}
    restart: always
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://0.0.0.0:80
      ConnectionStrings__ams: ${AMS_DB}
      Serilog__LogstashUrl: http://${AMS_PROJECT_EXTERNAL_DNS_NAME_OR_IP}:8080
      Serilog__MinimumLevel: ${MIN_LOG_LEVEL}

  memo-client:
    image: ${REGISTRY}/memo.client:${PLATFORM}-${TAG}
    restart: always

  # ===========================================
  # BOM LINK
  # ===========================================
  bom-link-client:
    image: ${REGISTRY}/bom.link.client:${PLATFORM}-${TAG}
    restart: always

volumes:
  smtp4dev-data: {}
  profilePictures: {}
  esdata: {}
  esindex: {}
  healthdata: {}
  eventstore-volume-data: {}
  eventstore-volume-logs: {}
