# v0.16 – Release & TLS Management

Technical specification for the v0.16 features.

## Overview

v0.16 adds two main features:
1. **Release Management UI** - Display current version and check for updates
2. **Custom TLS Certificates** - Upload and manage custom SSL/TLS certificates

---

## 1. Release Management UI

### 1.1 Goals

- Display current ReadyStackGo version in the UI
- Check for available updates via GitHub Releases API
- Show update notification with link to release notes
- Allow dismissing update notifications

### 1.2 API Design

#### GET /api/system/version

Returns system version information.

**Response:**
```json
{
  "serverVersion": "0.15.0",
  "updateAvailable": true,
  "latestVersion": "0.16.0",
  "latestReleaseUrl": "https://github.com/Wiesenwischer/ReadyStackGo/releases/tag/v0.16.0",
  "build": {
    "gitCommit": "abc123",
    "buildDate": "2026-01-22T10:00:00Z"
  }
}
```

### 1.3 Implementation Details

**Backend:**
- `SystemController` with version endpoint
- Fetch latest release from GitHub API: `https://api.github.com/repos/Wiesenwischer/ReadyStackGo/releases/latest`
- SemVer comparison using `System.Version` or NuGet package
- Cache GitHub response (24h) to avoid rate limits
- Version info from assembly metadata

**Frontend:**
- `useSystemVersion()` React Query hook
- `UpdateNotification` component in sidebar footer
- Dismissable notification (store in localStorage)
- Link to "See what's new" (GitHub release page)

### 1.4 UI Mockup

```
┌─────────────────────────────────────────────┐
│ ⬇️ Update Available: v0.16.0               │
│ [Dismiss] [See what's new]                  │
└─────────────────────────────────────────────┘
```

---

## 2. Custom TLS Certificates

### 2.1 Goals

- Replace self-signed certificates with custom certificates
- Support PFX and PEM formats
- Display current certificate status (expiration, issuer, subject)
- Validate certificates before applying

### 2.2 Current State

ReadyStackGo already has TLS infrastructure (see `docs/Security/TLS-Configuration.md`):
- Self-signed certificate generation on first start
- `rsgo.tls.json` configuration file
- Certificates stored in `/app/certs/`

### 2.3 API Design

#### GET /api/system/tls

Returns current TLS configuration.

**Response:**
```json
{
  "mode": "SelfSigned",
  "certificateInfo": {
    "subject": "CN=localhost",
    "issuer": "CN=ReadyStackGo Self-Signed",
    "expiresAt": "2027-01-22T00:00:00Z",
    "thumbprint": "A1B2C3...",
    "isSelfSigned": true
  },
  "httpEnabled": false
}
```

#### PUT /api/system/tls

Update TLS settings.

**Request (PFX upload):**
```json
{
  "pfxBase64": "base64-encoded-pfx-content",
  "pfxPassword": "certificate-password"
}
```

**Request (PEM upload):**
```json
{
  "certificatePem": "-----BEGIN CERTIFICATE-----\n...",
  "privateKeyPem": "-----BEGIN PRIVATE KEY-----\n..."
}
```

**Request (HTTP toggle only):**
```json
{
  "httpEnabled": true
}
```

### 2.4 Implementation Details

**Backend:**
- `TlsController` with GET/PUT endpoints
- `TlsService` for certificate management
- Certificate validation (expiration, private key match)
- Store in `/app/certs/custom.pfx`
- Update `rsgo.tls.json` with `mode: Custom`
- Application restart notification (certs loaded at startup)

**Frontend:**
- New "TLS/SSL" tab in Settings page
- Current certificate status display
- PFX or PEM file upload (drag & drop)
- Password input for PFX
- HTTP/HTTPS toggle
- Validation feedback

### 2.5 UI Design

New Settings tab: "TLS/SSL"

```
┌─────────────────────────────────────────────────────────────┐
│ TLS/SSL Settings                                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ Current Certificate Status                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Type:    Self-Signed ⚠️                                 │ │
│ │ Subject: CN=localhost                                   │ │
│ │ Issuer:  CN=ReadyStackGo Self-Signed                   │ │
│ │ Expires: Jan 22, 2027                                   │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ HTTP Configuration                                          │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [ ] Enable HTTP access (port 8080)                      │ │
│ │     Both HTTP and HTTPS will be available.              │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ Upload Custom Certificate                                   │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Format: (•) PFX  ( ) PEM                                │ │
│ │                                                         │ │
│ │ ┌───────────────────────────────────────────────────┐   │ │
│ │ │  Drop .pfx file here or click to browse           │   │ │
│ │ └───────────────────────────────────────────────────┘   │ │
│ │                                                         │ │
│ │ Password: [________________________]                    │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│                              [Update TLS Settings]          │
│                                                             │
│ ⚠️ Note: Application will restart after certificate change  │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. Implementation Plan

### Phase 1: Release Management UI
1. Create `SystemController` with version endpoint
2. Implement GitHub release check with caching
3. Add `useSystemVersion` hook
4. Create `UpdateNotification` component
5. Add version display to Settings/About section

### Phase 2: TLS Management
1. Create `TlsController` with GET/PUT endpoints
2. Implement `TlsService` for certificate operations
3. Add "TLS/SSL" tab to Settings page
4. Implement certificate upload UI (PFX/PEM)
5. Add certificate validation and status display

### Phase 3: Testing & Documentation
1. Unit tests for version comparison
2. Integration tests for TLS endpoints
3. E2E tests for Settings UI
4. Update documentation

---

## 4. Files to Create/Modify

### Backend
- `src/ReadyStackGo.Api/Controllers/SystemController.cs` (new)
- `src/ReadyStackGo.Api/Controllers/TlsController.cs` (new)
- `src/ReadyStackGo.Infrastructure/Services/VersionCheckService.cs` (new)
- `src/ReadyStackGo.Infrastructure/Services/TlsService.cs` (new)
- `src/ReadyStackGo.Application/UseCases/System/GetVersion/` (new)
- `src/ReadyStackGo.Application/UseCases/System/GetTlsConfig/` (new)
- `src/ReadyStackGo.Application/UseCases/System/UpdateTlsConfig/` (new)

### Frontend
- `src/ReadyStackGo.WebUi/src/api/system.ts` (new)
- `src/ReadyStackGo.WebUi/src/hooks/useSystemVersion.ts` (new)
- `src/ReadyStackGo.WebUi/src/components/UpdateNotification.tsx` (new)
- `src/ReadyStackGo.WebUi/src/pages/Settings.tsx` (modify - add TLS tab)
- `src/ReadyStackGo.WebUi/src/components/TlsSettings.tsx` (new)

---

## 5. References

- Portainer: `api/http/handler/system/version.go`, `app/react/sidebar/Footer/UpdateNotifications.tsx`
- SPE-Project: `migrations-web/src/app/components/SSLSettings.tsx`
- Existing RSGo docs: `docs/Security/TLS-Configuration.md`
