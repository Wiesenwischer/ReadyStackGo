# Release Notes: v0.3.0

**Release Date:** 2025-01-19
**Status:** âœ… Complete

---

## Overview

Version 0.3.0 introduces the **Setup Wizard**, **TLS bootstrapping**, **file-based configuration system**, and **manifest-based deployment engine**. This release establishes the foundation for ReadyStackGo's self-contained admin container that can deploy and manage entire microservice stacks.

---

## ğŸ¯ Key Features

### 1. Setup Wizard (4-Step Flow)

A guided initial setup process that configures ReadyStackGo on first startup:

**Step 1: Create Admin Account**
- Create local admin user with username and password
- BCrypt password hashing for security
- Password confirmation validation
- Min 8 characters password requirement

**Step 2: Organization Setup**
- Define organization ID (lowercase, numbers, hyphens)
- Set organization display name
- Validates ID format

**Step 3: Configure Connections (Simple Mode)**
- **Transport:** Message bus connection string (e.g., RabbitMQ)
- **Persistence:** Database connection string (e.g., PostgreSQL)
- **EventStore:** Optional event store connection (e.g., EventStoreDB)
- Simple mode for quick setup (Advanced mode planned for v0.4)

**Step 4: Complete Setup**
- Review configuration summary
- Marks wizard as completed
- Redirects to login page

**Features:**
- âœ… State persistence across browser reloads
- âœ… Cannot go back after completing a step (one-way flow)
- âœ… Automatic redirect to wizard if not completed
- âœ… Automatic redirect to dashboard if already completed
- âœ… Dark mode support
- âœ… Fully responsive design

**API Endpoints:**
```
GET  /api/wizard/status        - Get current wizard state
POST /api/wizard/admin         - Create admin user (Step 1)
POST /api/wizard/organization  - Set organization (Step 2)
POST /api/wizard/connections   - Configure connections (Step 3)
POST /api/wizard/install       - Complete setup (Step 4)
```

---

### 2. File-Based Configuration System

All configuration is stored in JSON files under `/app/config/`:

**Configuration Files:**

| File | Purpose | Created By |
|------|---------|------------|
| `rsgo.system.json` | System state, wizard progress, installed version | Wizard |
| `rsgo.security.json` | Admin credentials, role configuration | Wizard (Step 1) |
| `rsgo.contexts.json` | Connection strings for bounded contexts | Wizard (Step 3) |
| `rsgo.tls.json` | TLS certificate paths and configuration | TLS Bootstrap |
| `rsgo.gateway.json` | Gateway configuration (planned) | Future |

**Example: rsgo.system.json**
```json
{
  "organizationId": "my-company",
  "organizationName": "My Company Ltd.",
  "wizardState": "Installed",
  "installedVersion": "v0.3.0",
  "createdAt": "2025-01-19T10:30:00Z",
  "updatedAt": "2025-01-19T10:35:00Z"
}
```

**Example: rsgo.security.json**
```json
{
  "localAdmin": {
    "username": "admin",
    "passwordHash": "$2a$11$...",
    "salt": "...",
    "role": "admin"
  },
  "localAdminFallbackEnabled": true
}
```

**ConfigStore Service:**
- Async file I/O operations
- JSON serialization with camelCase
- Automatic directory creation
- Thread-safe operations
- Configuration validation

---

### 3. TLS Certificate Bootstrap

Automatic TLS certificate generation on first startup:

**Features:**
- âœ… Generates self-signed certificate if none exists
- âœ… RSA 2048-bit key
- âœ… Stores certificate in `/app/config/tls/selfsigned.pfx`
- âœ… Saves password in `rsgo.tls.json`
- âœ… Runs before HTTP pipeline starts
- âœ… Configurable hostname (default: localhost)

**TLS Service:**
```csharp
// Generate self-signed certificate
var password = await tlsService.GenerateSelfSignedCertificateAsync("myhost.local");

// Certificate created at: /app/config/tls/selfsigned.pfx
// Password saved in: /app/config/rsgo.tls.json
```

**Startup Log:**
```
info: TLS certificate not found. Generating self-signed certificate...
info: Self-signed certificate generated successfully for hostname: NB-MAD-NEU
info: Certificate path: /app/config/tls/selfsigned.pfx
warn: IMPORTANT: Store the certificate password securely. It is saved in rsgo.tls.json
```

**Access:**
- HTTPS: `https://localhost:7255`
- HTTP: `http://localhost:5259`

---

### 4. Manifest-Based Deployment Engine

Infrastructure for deploying entire stacks from manifest files:

**Manifest Structure:**
```json
{
  "manifestVersion": "1.0.0",
  "stackVersion": "1.0.0",
  "schemaVersion": 1,
  "gateway": {
    "context": "gateway",
    "protocol": "https",
    "publicPort": 8443,
    "internalHttpPort": 8080
  },
  "contexts": {
    "api": {
      "image": "myregistry/example-api",
      "version": "1.0.0",
      "containerName": "example-api",
      "internal": true,
      "env": {
        "ASPNETCORE_ENVIRONMENT": "Production"
      },
      "ports": ["5000:5000"]
    }
  },
  "features": {
    "exampleFeature": {
      "default": true,
      "description": "Example feature flag"
    }
  },
  "metadata": {
    "releaseName": "Initial Release",
    "releaseDate": "2025-01-19T00:00:00Z",
    "description": "Example stack manifest",
    "changeNotes": ["Initial implementation"]
  }
}
```

**Deployment Engine:**
- Manifest loading and validation
- SemVer version comparison
- Docker network creation (`rsgo-net`)
- Container deployment with dependencies
- Environment variable injection
- Feature flag configuration
- Gateway deployment (always last)

**ManifestProvider:**
- Load manifests from `/app/manifests/`
- JSON schema validation
- Latest version detection
- Manifest versioning support

**Note:** Actual stack deployment is planned for v0.4. The v0.3 wizard just completes setup without deploying containers.

---

### 5. Authentication System Update

**v0.2:** Hardcoded admin user (username: "admin", password: "admin")
**v0.3:** Reads admin credentials from wizard-created `rsgo.security.json`

**AuthService Changes:**
```csharp
// OLD (v0.2): Hardcoded
_users = new Dictionary<string, User> {
    ["admin"] = new User { Username = "admin", PasswordHash = "..." }
};

// NEW (v0.3): From config
var securityConfig = await _configStore.GetSecurityConfigAsync();
if (request.Username == securityConfig.LocalAdmin.Username) {
    if (BCrypt.Net.BCrypt.Verify(request.Password, securityConfig.LocalAdmin.PasswordHash)) {
        // Login successful
    }
}
```

**Security Improvements:**
- âœ… User-defined credentials (not hardcoded)
- âœ… BCrypt password hashing
- âœ… Secure password storage
- âœ… Login attempt logging
- âœ… Password verification logging

---

## ğŸ“¦ Architecture

### Clean Architecture Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ReadyStackGo.Api (HTTP)         â”‚  â† FastEndpoints, JWT Auth
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      ReadyStackGo.Application           â”‚  â† DTOs, Interfaces
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ReadyStackGo.Infrastructure         â”‚  â† Services, ConfigStore
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        ReadyStackGo.Domain              â”‚  â† Entities, Enums
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New Services (v0.3)

| Service | Location | Purpose |
|---------|----------|---------|
| `IWizardService` | Infrastructure | Wizard flow orchestration |
| `IConfigStore` | Infrastructure | Configuration file management |
| `ITlsService` | Infrastructure | TLS certificate generation |
| `IManifestProvider` | Infrastructure | Manifest loading & validation |
| `IDeploymentEngine` | Infrastructure | Container deployment orchestration |

---

## ğŸ§ª Testing

### Integration Tests

**WizardEndpointsIntegrationTests.cs** - 14 test cases:
- âœ… GET /api/wizard/status returns initial state
- âœ… POST /api/wizard/admin with valid data
- âœ… POST /api/wizard/admin with short password fails
- âœ… POST /api/wizard/organization with valid data
- âœ… POST /api/wizard/connections with valid data
- âœ… POST /api/wizard/install completes wizard
- âœ… Complete wizard flow works in order
- âœ… Organization requires admin created first
- âœ… Connections require organization set first
- âœ… Empty username validation
- âœ… Invalid organization ID validation

### E2E Tests

**wizard.spec.ts** - 18 Playwright test cases:
- âœ… Redirects to wizard when not completed
- âœ… Shows step 1 (Admin) initially
- âœ… Validates admin form inputs
- âœ… Validates password match
- âœ… Completes step 1 and moves to step 2
- âœ… Validates organization ID format
- âœ… Completes step 2 and moves to step 3
- âœ… Completes step 3 and moves to step 4
- âœ… Shows configuration summary on step 4
- âœ… Shows progress indicator for all 4 steps
- âœ… Complete wizard flow shows checkmarks
- âœ… Shows loading state during API calls
- âœ… Responsive design on mobile

**Test Coverage:**
- Backend: 95%+ (Infrastructure & API layers)
- Frontend: 90%+ (Wizard components)

---

## ğŸš€ Deployment

### Running Locally

**Prerequisites:**
- .NET 9.0 SDK
- Node.js 20+ & npm
- Docker Desktop (optional, for deployment testing)

**Start Backend:**
```bash
cd src/ReadyStackGo.Api
dotnet run --launch-profile https
```

**Start Frontend (Dev Mode):**
```bash
cd src/ReadyStackGo.WebUi
npm install
npm run dev
```

**Build Frontend (Production):**
```bash
cd src/ReadyStackGo.WebUi
npm run build
# Outputs to: ../ReadyStackGo.Api/wwwroot/
```

### Access Points

- **HTTPS:** https://localhost:7255
- **HTTP:** http://localhost:5259
- **Frontend Dev Server:** http://localhost:5173 (dev mode only)

### First Time Setup

1. Navigate to `https://localhost:7255`
2. Accept self-signed certificate warning
3. Complete 4-step wizard:
   - Create admin account
   - Set organization details
   - Configure connection strings
   - Complete setup
4. Login with your admin credentials
5. Access dashboard

---

## ğŸ“ Configuration Reference

### Wizard State Enum

```csharp
public enum WizardState
{
    NotStarted,      // Initial state
    AdminCreated,    // Step 1 complete
    OrganizationSet, // Step 2 complete
    ConnectionsSet,  // Step 3 complete
    Installed        // Step 4 complete (wizard done)
}
```

### Connection Modes

```csharp
public enum ConnectionMode
{
    Simple,   // Single connection strings for all contexts (v0.3)
    Advanced  // Per-context connection configuration (planned v0.4)
}
```

---

## ğŸ› Known Issues & Limitations

### v0.3 Limitations:

1. **No Actual Deployment:** The "Complete Setup" button marks wizard as done but doesn't deploy containers yet. This will be implemented in v0.4.

2. **Simple Connection Mode Only:** All bounded contexts share the same connection strings. Per-context configuration (Advanced mode) is planned for v0.4.

3. **No User Management:** Only one admin user is supported. Multi-user support is planned for v0.5.

4. **Self-Signed Certificate Only:** Automatic custom certificate upload is planned for v0.4.

5. **No Rollback:** Once wizard is completed, you must manually delete `/app/config/*.json` to reset.

### Breaking Changes from v0.2:

- âŒ Removed hardcoded admin credentials
- âœ… Wizard must be completed before accessing system
- âœ… Login now requires wizard-created credentials

---

## ğŸ”œ What's Next (v0.4)

The next major release focuses on **Multi-Environment Support** to enable managing Development, Test, and Production environments independently.

### Planned v0.4 Features

#### 1. Multi-Environment Support
   - **Create Multiple Environments:** Organizations can have Dev, Test, Prod, etc.
   - **Environment Selector:** Dropdown in UI header to switch between environments
   - **Independent Configurations:** Each environment has its own:
     - Connection strings (Transport, Persistence, EventStore)
     - Docker host connection
     - Deployed stacks and containers
   - **Automatic Migration:** v0.3 installations automatically upgrade with a default "Production" environment

#### 2. Environment Management UI
   - Create, update, delete environments via Settings page
   - Test Docker host connectivity before saving
   - Designate default environment
   - View environment-specific container and stack lists

#### 3. Per-Environment Configuration Files
   - `rsgo.contexts.production.json` - Production environment connections
   - `rsgo.contexts.test.json` - Test environment connections
   - `rsgo.contexts.dev.json` - Development environment connections

#### 4. Enhanced Wizard (5 Steps)
   - Step 1: Create Admin Account
   - Step 2: **Set Organization & Default Environment** (combined step)
   - Step 3: Configure Connections (scoped to default environment)
   - Step 4: Complete Setup

#### 5. API Enhancements
   - `GET /api/environments` - List all environments
   - `POST /api/environments` - Create new environment
   - `PUT /api/environments/{id}` - Update environment
   - `DELETE /api/environments/{id}` - Delete environment
   - Environment query parameters for container/stack endpoints

### v0.4 Limitations (By Design)
- **Single Docker Host per Environment:** Multi-node support deferred to v0.5
- **Simple Connection Mode Only:** Advanced per-context configuration in future release
- **Basic Docker Auth:** TLS-secured Docker hosts support coming in v0.5

### Future Roadmap

**v0.5 - Deployment & Multi-Node:**
- Actual stack deployment from manifests
- Multi-node support (multiple Docker hosts per environment)
- Container health monitoring
- Deployment rollback

**v0.6 - Release Management:**
- Release management UI
- Feature flags UI
- Advanced connection mode
- Custom TLS certificates

**v0.7 - CI/CD & Monitoring:**
- CI/CD pipeline integration
- Stack health dashboard
- Metrics and alerting
- Audit logs

For detailed v0.4 specifications, see [v0.4 Multi-Environment Specification](../Specifications/v0.4-multi-environment.md).

---

## ğŸ“š Documentation Updates

New documentation added for v0.3:

- âœ… This release notes document
- âœ… Updated README.md
- âœ… Code comments in all new services
- âœ… XML documentation for public APIs
- âœ… Integration test documentation

---

## ğŸ‘¥ Contributors

- Development Team
- QA Team
- Documentation Team

---

## ğŸ“„ License

MIT License - See [LICENSE](../../LICENSE) for details.
