---
// Fetch roadmap from GitHub at build time
const response = await fetch('https://raw.githubusercontent.com/Wiesenwischer/ReadyStackGo/main/ROADMAP.md');
const markdown = await response.text();

interface Props {
  lang?: 'en' | 'de';
}

const { lang = 'en' } = Astro.props;

const labels = {
  en: {
    viewSource: 'View source on GitHub',
  },
  de: {
    viewSource: 'Quelle auf GitHub ansehen',
  }
};

const t = labels[lang];

// Parse markdown into sections
interface RoadmapItem {
  version: string;
  title: string;
  features: string[];
}

function parseRoadmap(md: string): RoadmapItem[] {
  const items: RoadmapItem[] = [];
  const lines = md.split('\n');
  let currentItem: RoadmapItem | null = null;

  for (const line of lines) {
    // Match version headers like "## v1.0 - Production Readiness"
    const headerMatch = line.match(/^## (v[\d.]+)\s*-\s*(.+)$/);
    if (headerMatch) {
      if (currentItem) {
        items.push(currentItem);
      }
      currentItem = {
        version: headerMatch[1],
        title: headerMatch[2].trim(),
        features: []
      };
      continue;
    }

    // Match feature items like "- Feature description"
    const featureMatch = line.match(/^- (.+)$/);
    if (featureMatch && currentItem) {
      currentItem.features.push(featureMatch[1].trim());
    }
  }

  if (currentItem) {
    items.push(currentItem);
  }

  return items;
}

const roadmapItems = parseRoadmap(markdown);
---

<div class="roadmap">
  {roadmapItems.map((item) => (
    <div class="roadmap-item">
      <h3>
        <code class="version">{item.version}</code>
        {item.title}
      </h3>
      <ul>
        {item.features.map((feature) => (
          <li>{feature}</li>
        ))}
      </ul>
    </div>
  ))}
</div>

<p class="roadmap-source">
  <a href="https://github.com/Wiesenwischer/ReadyStackGo/blob/main/ROADMAP.md" target="_blank" rel="noopener">
    {t.viewSource} â†—
  </a>
</p>

<style>
  .roadmap {
    margin: 1.5rem 0;
  }
  .roadmap-item {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: var(--sl-color-gray-7);
    border-radius: 8px;
    border-left: 4px solid var(--sl-color-accent);
  }
  .roadmap-item h3 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 0 0 0.75rem 0;
    flex-wrap: wrap;
  }
  .version {
    font-size: 0.85em;
    font-weight: bold;
    padding: 0.2em 0.6em;
    background: var(--sl-color-accent);
    color: var(--sl-color-black);
    border-radius: 4px;
  }
  .roadmap-item ul {
    margin: 0;
    padding-left: 1.5rem;
  }
  .roadmap-item li {
    margin: 0.25rem 0;
  }
  .roadmap-source {
    font-size: 0.9rem;
    color: var(--sl-color-gray-3);
  }
</style>
